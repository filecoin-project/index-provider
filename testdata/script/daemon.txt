# uninitialized provider fails to start daemon
! provider daemon
stderr 'Reference provider is not initialized'
! stdout .

# initialized provider starts daemon successfully
provider init
stdout 'generating ED25519 keypair...done\npeer identity: '
! stderr .
provider daemon &
await_tcp_dial localhost:3102 5s
! stderr .
! stdout .

# TODO: move import tests to `import-car.txt` script once we can configure admin server address. 
# For now we leave them here because otherwise ports crash when tests run in parallel.

# initialized provider with daemon running can import CARv1
provider import car -l http://localhost:3102 -i ${TESTDATA}/sample-v1.car
stdout 'Successfully imported CAR.\n\t Advertisement ID: ba'
! stderr .

# initialized provider with daemon running can import CARv2
# provider import car -l http://localhost:3102 -i ${TESTDATA}/sample-wrapped-v2.car
# stdout 'Successfully imported CAR.\n\t Advertisement ID: ba'
# ! stderr .
